# overpass-requester

Сервис, который получает координаты точек, посредством HTTP-запросов в [Overpass API](https://overpass-turbo.eu/).

### Стэк

* С# .NET

### Запуск

1. Установка всех пакетов 
`npm ci`
2. Запуск
`npm run start:overpass-requester`

### Принцип работы

1. Изначально сервис считывает с файла ([см. Конфигурацию п.1](#конфигурация)) все точки и сохраняет их в памяти.
2. Далее сервис ждет сообщения из очереди ([см. Конфигурацию п.5](#конфигурация)), и когда приходят данные он составляет множество уникальных названий магазинов.
3. Далее происходят асинхронные запросы в API, которым достаточно в среднем 14-15 секунд. Далее создаются сопоставления названия магазинов и точек. Если в результате запроса что-либо нашлось, то все точки идут в сопоставление, если нет - то берется случайное количество ([см. Конфигурацию п.2](#конфигурация)) точек из памяти.
4. После этого сервис делает сопоставления id товара и магазина. Данные для магазина он берет из данных, пришедших из очереди, а координаты из сопоставлений, сделанных в п.3. Полученные данные он отправляет их в нужную ([см. Конфигурацию п.4](#конфигурация)) очередь. Затем возвращается к п.2, ожидая сдедующего сообщения.

### Конфигурация

Настройки можно производить в конфигурационном классе `Config`, находящемуся по пути `./app/Config.cs`.

1. **DataPath** - Путь до файла со всеми точками
2. **MaxNodesNumber** - Максимальное количество точек для выбора при генерации рандомных точек
3. **OsmRequesterExchange** - Название обменника
4. **ShopsInRoutingKey** - Название ключа маршрутизации для магазинов
5. **ProductsOutQueue** - Название очереди для сопоставления товаров и названий магазинов
6. **OverpassTimeout** - Таймаут для запросов в Overpass API